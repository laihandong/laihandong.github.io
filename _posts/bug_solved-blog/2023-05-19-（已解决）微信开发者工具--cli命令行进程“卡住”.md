# （已解决）使用subprocess 调用cli login，进程卡死

使用python subprocess启动该命令，会在p.communicate或者p.wait**卡住**



以下是对问题的分析：

1.cli login 该命令属于**需要交互的命令**，即正常在cmd中运行时，它会先输出二维码，等待用户扫码，**扫码确认登陆后进程才会结束**。

2.微信开发者命令行工具 cli 本质是启用**集成在软件安装目录下的node环境调用js脚本来实现的**

3.js又默认把输出缓存在内存中，而**不会立即把输出传回给调用调用命令的python脚本**。导致python脚本**捕捉不到**包含二维码信息的**输出**，且**一直等待用户登录，进程就不会结束**

4.通过任务管理器关闭 微信开发者工具 的进程，该命令的进程仍不会结束，依然卡住。猜测就是，使用命令行调起的进程，和双击 微信开发者工具 调起的进程，两者互不影响？

验证：同时启动 微信开发者工具.exe 和 cli login，两者都会弹出登录二维码。扫描登录后者的二维码进行登录，cli login 进程结束的同时，微信开发者工具也会跳转到项目配置页面。但是扫描前者的二维码进行登陆后，cli login仍然卡在“\ waiting for scan and login”，不会结束

事实证明：**想将微信开发者工具集成到自己的测试工具中，不推荐使用类似cli login等需要交互的命令行**



（ps：有尝试过新建两个streamReader，并为它们各自新建一个进程，实时读取cli login的输出，这样就不会等待该进程结束后才拿得到二维码，但是事实上发现拿到的二维码是不连续的，中间会被其它输出隔断。像这样，输出一半的二维码，然后有几行字，再出现一半的二维码）



